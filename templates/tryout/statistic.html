{% extends 'base.html' %}
{% load static listing %}
{% load crispy_forms_tags %}

{% block head_title %}Statistik{% endblock %}
{% block content_title %}Statistik{% endblock %}

{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'app-assets/vendors/css/charts/apexcharts.css' %}">
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-8 col-12">
            <div class="card mt-1">
                <div class="card-content">
                    <div class="card-body">
                        <form action="{% url 'statistic' %}" method="POST">
                            {% csrf_token %}

                            <div class="d-flex w-100">
                                <div class="mr-auto w-100">
                                    <select name="category" class="form-control w-100">
                                        <option value="0">Pilih Kategori</option>
                                        {% for item in categories %}
                                            <option value="{{ item.id }}" {% if item.id == category %}selected{% endif %}>
                                                {{ item.label }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="pl-2">
                                    <button type="submit" class="btn btn-primary">Saring</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {% if simulations %}
                <div class="card widget-order-activity">
                    <div class="card-content">
                        <div class="card-body">
                            <div id="order-activity-line-chart"></div>
                        </div>
                    </div>
                </div>
                <!-- Order Activity Chart Ends -->
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block js %}
    {% if simulations %}
        <script src="{% static 'app-assets/vendors/js/charts/apexcharts.min.js' %}"></script>

        <script type="text/javascript">
            var $primary = '#5A8DEE';
            var $success = '#39DA8A';
            var $danger = '#FF5B5C';
            var $warning = '#FDAC41';
            var $info = '#00CFDD';
            var $label_color = '#304156';
            var $danger_light = '#FFDEDE';
            var $gray_light = '#828D99';
            var $bg_light = "#f2f4f4";

            var labels = [];
            var scores = [];

            {% for item in simulations %}
                labels.push('{{ item.packet.label }}');
                scores.push('{{ item.total_score }}');
            {% endfor %}

            // Order Activity Line Chart
            // -------------------------
            var orderActivityChartOptions = {
                chart: {
                    height: 350,
                    type: 'line',
                    toolbar: {
                        show: false
                    }
                },
                colors: [$primary],
                dataLabels: {
                    enabled: false,
                },
                series: [
                    {
                        data: scores
                    }
                ],
                markers: {
                    size: 5,
                    hover: {
                        size: 7,
                        sizeOffset: 7
                    },
                },
                xaxis: {
                    categories: labels,
                    axisTicks: {
                        show: false
                    },
                    axisBorder: {
                        show: false
                    },
                    labels: {
                        style: {
                            colors: $gray_light
                        },
                        offsetX: 3,
                    }
                },
                yaxis: {
                    min: 0,
                    max: {{ simulations_highest.total_score }},
                    tickAmount: 1,
                    labels: {
                        style: {
                            color: $gray_light
                        }
                    }
                },
                grid: {
                    padding: {
                        left: 15
                    }
                }
            }

            var orderActivityChart = new ApexCharts(
                document.querySelector("#order-activity-line-chart"),
                orderActivityChartOptions
            );
            orderActivityChart.render();
        </script>
    {% endif %}
{% endblock %}